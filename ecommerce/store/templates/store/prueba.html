<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <title>TechShop</title>
</head>
<body>

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-info">
  <a class="navbar-brand text-light {% if not request.user.is_authenticated %}disabled{% endif %}" href="{% if request.user.is_authenticated %}{% url 'store' %}{% else %}#{% endif %}">TechShop</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <!--<li class="nav-item active">
        <a class="nav-link text-light" href="{% url 'store' %}">Store <span class="sr-only">(current)</span></a>
      </li>-->
    </ul>
    <div class="form-inline my-2 my-lg-0">
      <div class="dropdown {% if not request.user.is_authenticated %}disabled{% endif %}">
        <button type="button" class="btn btn-light mr-2 rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Perfil de usuario
        </button>
        <div class="dropdown-menu">
          {% if request.user.is_authenticated %}
          <a class="dropdown-item" href="{% url 'profile' %}">{{ request.user.username }}</a>
          <a class="dropdown-item" href="{% url 'logout' %}">Cerrar sesión</a>
          {% else %}
          <a class="dropdown-item" href="{% url 'login' %}">Iniciar sesión</a>
          <a class="dropdown-item" href="{% url 'register' %}">Registrarse</a>
          {% endif %}
      </div>
      

      <a type="button" href="{% if request.user.is_authenticated %}{% url 'cart' %}{% else %}#{% endif %}" class="btn btn-light position-relative {% if not request.user.is_authenticated %}disabled{% endif %}">
        <i class="bi bi-cart"></i>
        {% if request.user.is_authenticated %}
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger text-light">
            {{cartItems}}
        </span>
        {% endif %}
      </a>
    
    </div>
  </div>
</nav>

<div class="container-fluid mt-5">

    <br>
    {% block content %}


     {% endblock content %}

</div>

<!-- Footer -->
<footer class="text-center text-lg-start bg-body-tertiary text-muted mt-5">
  <!-- Section: Social media -->
  <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
    <!-- Left -->
    <div class="me-5 d-none d-lg-block">
      <span>Conoce nuestros contactos y nuestra empresa:</span>
    </div>
    <!-- Left -->

  </section>
  <!-- Section: Social media -->

  <!-- Section: Links  -->
  <section class="">
    <div class="container text-center text-md-start mt-5">
      <!-- Grid row -->
      <div class="row mt-3">
        <!-- Grid column -->
        <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
          <!-- Content -->
          <h6 class="text-uppercase fw-bold mb-4">
            <i class="fas fa-gem me-3"></i>TechShop
          </h6>
          <p>
            Somos un grupo de jóvenes amantes de la Tecnología y queremos brindarle el mejor servicio
            con los mejores artículos de computadoras.
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
          <!-- Links -->
          <h6 class="text-uppercase fw-bold mb-4">
            Productos
          </h6>
          <p>
            <a href="#!" class="text-reset">Procesador</a>
          </p>
          <p>
            <a href="#!" class="text-reset">Tarjeta Madre</a>
          </p>
          <p>
            <a href="#!" class="text-reset">Memoria</a>
          </p>
          <p>
            <a href="#!" class="text-reset">Almacenamiento</a>
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
          <!-- Links -->
          <h6 class="text-uppercase fw-bold mb-4">
            Precios
          </h6>
          <p>
            <a href="#!" class="text-reset">Ofertas</a>
          </p>
          <p>
            <a href="#!" class="text-reset">20% de descuento</a>
          </p>
          <p>
            <a href="#!" class="text-reset">30% de descuento</a>
          </p>
          <p>
            <a href="#!" class="text-reset">40% de descuento</a>
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
          <!-- Links -->
          <h6 class="text-uppercase fw-bold mb-4">Contacto</h6>
          <p><i class="fas fa-home me-3"></i> Campeche, Concordia, #17 24012, México</p>
          <p>
            <i class="fas fa-envelope me-3"></i>
            TechShop@gmail.com
          </p>
          <p><i class="fas fa-phone me-3"></i> + 52 981 567 0988</p>
          <p><i class="fas fa-print me-3"></i> + 52 981 136 8880</p>
        </div>
        <!-- Grid column -->
      </div>
      <!-- Grid row -->
    </div>
  </section>
  <!-- Section: Links  -->

  <!-- Copyright -->
  <div class="text-center text-white p-4 bg-info">
    © 2024 Copyright:
    <a class="text-white fw-bold" href="#">TechShop.com</a>
  </div>
  <!-- Copyright -->
</footer>
<!-- Footer -->

  <script type="text/javascript">
    var user = '{{request.user}}'

    function getToken(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getToken('csrftoken')

    function getCookie(name) {
        // Split cookie string and get all individual name=value pairs in an array
        var cookieArr = document.cookie.split(";");

        // Loop through the array elements
        for(var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split("=");

            /* Removing whitespace at the beginning of the cookie name
            and compare it with the given string */
            if(name == cookiePair[0].trim()) {
                // Decode the cookie value and return
                return decodeURIComponent(cookiePair[1]);
            }
        }

        // Return null if not found
        return null;
    }
    var cart = JSON.parse(getCookie('cart'))

    if (cart == undefined){
      cart = {}
      console.log('Cart Created!', cart)
      document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"
    }
    console.log('Cart:', cart)
  
  </script>

    
  <script type="text/javascript">
    var user = '{{request.user}}'

    function getToken(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getToken('csrftoken')

    function getCookie(name) {
        // Split cookie string and get all individual name=value pairs in an array
        var cookieArr = document.cookie.split(";");

        // Loop through the array elements
        for(var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split("=");

            /* Removing whitespace at the beginning of the cookie name
            and compare it with the given string */
            if(name == cookiePair[0].trim()) {
                // Decode the cookie value and return
                return decodeURIComponent(cookiePair[1]);
            }
        }

        // Return null if not found
        return null;
    }
    var cart = JSON.parse(getCookie('cart'))

    if (cart == undefined){
      cart = {}
      console.log('Cart Created!', cart)
      document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"
    }
    console.log('Cart:', cart)
  
  </script>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	<script type="text/javascript" src="{% static 'js/cart.js' %}"></script>
</body>
</html>

from django.db import models
from django.contrib.auth.models import User
# Create your models here.


class Customer(models.Model):
    user = models.OneToOneField(User, null=True, blank=True, on_delete=models.CASCADE)
    name = models.CharField(max_length=200, null=True, blank=True)  # Hacer el nombre opcional
    email = models.EmailField(max_length=200)
    phone_number = models.CharField(max_length=20, blank=True, null=True)  # Campo adicional para el número de teléfono
    
    def __str__(self):
        return self.name if self.name else self.email
 
class Product(models.Model):
    seller = models.ForeignKey(User, on_delete=models.CASCADE)
    name = models.CharField(max_length=200, null=True)
    mark = models.CharField(max_length=100, null=True)
    price = models.FloatField()
    quantity = models.IntegerField(null=True)
    oferta = models.BooleanField(default=False, null=True, blank=False)
    description = models.TextField(max_length=1000, null=True)
    qualityuno = models.CharField(max_length=200, null=True)
    qualitydos = models.CharField(max_length=200, null=True)
    qualitytres = models.CharField(max_length=200, null=True)
    qualitycuatro = models.CharField(max_length=200, null=True)
    qualitycinco = models.CharField(max_length=200, null=True)
    qualityseis = models.CharField(max_length=200, null=True)
    qualitysiete = models.CharField(max_length=200, null=True)
    qualityocho = models.CharField(max_length=200, null=True)
    qualitynueve = models.CharField(max_length=200, null=True)
    digital = models.BooleanField(default=False, null=True, blank=False)
    SECTION_CHOICES = [
    ('MEMORIAS', 'MEMORIAS'),
    ('ALMACENAMIENTO', 'ALMACENAMIENTO'),
    ('PROCESADORES', 'PROCESADORES'),
    ('GABINETES', 'GABINETES'),
    ('MOUSES', 'MOUSES'),
    ('VENTILADORES', 'VENTILADORES'),
    ('MONITORES', 'MONITORES'),
    ('TECLADOS', 'TECLADOS'),
    ('TECLADOS GAMER', 'TECLADOS GAMER'),
    ('TARJETAS GRÁFICAS', 'TARJETAS GRÁFICAS'),
    ('TARJETAS MADRES', 'TARJETAS MADRES'),
    ('TARJETAS DE RED', 'TARJETAS DE RED'),
    # Agrega más opciones según sea necesario
    ]
    section = models.CharField(max_length=200, choices=SECTION_CHOICES, null=True)
    image = models.ImageField(null=True, blank=False)
    imageuno = models.ImageField(null=True, blank=False)
    imagedos = models.ImageField(null=True, blank=False)
    imagetres = models.ImageField(null=True, blank=False)
    imagecuatro = models.ImageField(null=True, blank=False)
    imagecinco = models.ImageField(null=True, blank=False)
    
    def __str__(self):
        return self.name
    
    @property
    def imageURL(self):
        try:
            url = self.image.url
        except:
            url = ''
        return url
    
    @property
    def imageunoURL(self):
        try:
            url = self.imageuno.url
        except:
            url = ''
        return url
    
    @property
    def imagedosURL(self):
        try:
            url = self.imagedos.url
        except:
            url = ''
        return url
    
    @property
    def imagetresURL(self):
        try:
            url = self.imagetres.url
        except:
            url = ''
        return url
    
    @property
    def imagecuatroURL(self):
        try:
            url = self.imagecuatro.url
        except:
            url = ''
        return url
    
    @property
    def imagecincoURL(self):
        try:
            url = self.imagecinco.url
        except:
            url = ''
        return url
    
class Order(models.Model):
    customer = models.ForeignKey(Customer, on_delete=models.SET_NULL, null=True, blank=True)
    date_ordered = models.DateTimeField(auto_now_add=True)
    complete = models.BooleanField(default=False, null=True, blank=False)
    transaction_id = models.CharField(max_length=200, null=True)
    
    def __str__(self):
        return str(self.id)
    
    @property
    def shipping(self):
        shipping = False
        orderitems = self.orderitem_set.all()
        for i in orderitems:
            if not i.product.digital:
                shipping = True
        return shipping

    @property
    def get_cart_items(self):
        orderitems = self.orderitem_set.all()
        total = sum([item.quantity for item in orderitems])
        return total


    @property
    def get_cart_total(self):
        orderitems = self.orderitem_set.all()
        total = sum([item.get_total for item in orderitems])
        return total
    
class OrderHistory(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    order = models.ForeignKey(Order, on_delete=models.CASCADE)
    
class OrderItem(models.Model):
    product = models.ForeignKey(Product, on_delete=models.SET_NULL, null=True)
    order = models.ForeignKey(Order, on_delete=models.SET_NULL, null=True)
    quantity = models.IntegerField(default=0, null=True, blank=False)
    date_added = models.DateTimeField(auto_now_add=True)
    
    @property
    def get_total(self):
        total = self.product.price * self.quantity
        return total

class ShippingAddress(models.Model):
    customer = models.ForeignKey(Customer, on_delete=models.SET_NULL, null=True)
    order = models.ForeignKey(Order, on_delete=models.SET_NULL, null=True)
    address = models.CharField(max_length=200, null=False)
    city = models.CharField(max_length=200, null=False)
    state = models.CharField(max_length=200, null=False)
    zipcode = models.CharField(max_length=200, null=False)
    date_added = models.DateTimeField(auto_now_add=True)
    
    def __str__(self):
        return self.address


{% extends 'store/main.html' %}
{% load static %}
{% block content %}

<section>
  <div class="container py-5">
    <div class="row">
      <div class="col">
        <nav aria-label="breadcrumb" class="bg-body-tertiary bg-danger rounded-3 p-3 mb-4">
             <h6>Bienvenido a tu perfil</h6>
        </nav>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3.webp" alt="avatar"
              class="rounded-circle img-fluid" style="width: 150px;">
            <h5 class="my-3">{{ user.username }} <i class="bi bi-check2-circle text-success"></i></h5>
            <p class="text-muted mb-1">Usuario TechShop</p>
            <div class="d-flex justify-content-center mb-2">
              <button type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-danger rounded-pill">Editar <i class="bi bi-pencil-square"></i></button>
              <div class="dropdow" style="margin-left: 5px;">
                <button class="btn btn-outline-danger rounded-pill dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Otros
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{% url 'addProduct' %}">Publicar producto <i class="bi bi-bag-plus-fill"></i></a></li>
                  <li><a class="dropdown-item" href="{% url 'productHistory' %}">Tus productos <i class="bi bi-clock-history"></i></a></li>
                  <li><a class="dropdown-item" href="#">Tus compras <i class="bi bi-bag-check"></i></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="card mb-4 mb-lg-0">
          <div class="card-body p-0">
            <ul class="list-group list-group-flush rounded-3">
              <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                <i class="fas fa-globe fa-lg text-warning"></i>
                <p class="mb-0">https://mdbootstrap.com</p>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                <i class="fab fa-github fa-lg" style="color: #333333;"></i>
                <p class="mb-0">mdbootstrap</p>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                <i class="fab fa-twitter fa-lg" style="color: #55acee;"></i>
                <p class="mb-0">@mdbootstrap</p>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                <i class="fab fa-instagram fa-lg" style="color: #ac2bac;"></i>
                <p class="mb-0">mdbootstrap</p>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                <i class="fab fa-facebook-f fa-lg" style="color: #3b5998;"></i>
                <p class="mb-0">mdbootstrap</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="card mb-4">
          <div class="card-body">
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Full Name</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">{{ user.username }}</p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Email</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">{{ user.email }}</p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Phone</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">981 123 4567</p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Fecha de registro</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">{{ user.date_joined|date:'d/m/Y' }}</p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Address</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">Bay Area, San Francisco, CA</p>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="card mb-4 mb-md-0">
              <div class="card-body">
                <p class="mb-4"><span class="text-primary font-italic me-1">assigment</span> Project Status
                </p>
                <p class="mb-1" style="font-size: .77rem;">Web Design</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">One Page</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Mobile Template</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Backend API</p>
                <div class="progress rounded mb-2" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card mb-4 mb-md-0">
              <div class="card-body">
                <p class="mb-4"><span class="text-primary font-italic me-1">assigment</span> Project Status
                </p>
                <p class="mb-1" style="font-size: .77rem;">Web Design</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">One Page</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Mobile Template</p>
                <div class="progress rounded" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="mt-4 mb-1" style="font-size: .77rem;">Backend API</p>
                <div class="progress rounded mb-2" style="height: 5px;">
                  <div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock content %}


<!-- Modal único por cada producto con un identificador único -->
<div class="modal fade" id="exampleModal{{ product.id }}" tabindex="-1" aria-labelledby="exampleModalLabel{{ product.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel{{ product.id }}">Editar información del producto <i class="bi bi-pencil-square"></i></h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Aquí imprimes el formulario de edición del producto -->
        <form method="POST" id="editProductForm{{ product.id }}">
          {% csrf_token %}
          {{ edit_product_form.as_p }} <!-- Esto imprimirá el formulario -->
          <!-- Agrega los demás campos del formulario aquí -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cerrar <i class="bi bi-caret-right-fill"></i></button>
            <button type="submit" form="editProductForm{{ product.id }}" class="btn btn-danger rounded-pill">Guardar cambios <i class="bi bi-floppy"></i></button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!--store-->
{% extends 'store/main.html' %}
{% load static %}
{% block content %}

<main class="container">
  <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-body-secondary">
    <div class="col-lg-6 px-0">
      <h1 class="display-4 fst-italic">Title of a longer featured blog post</h1>
      <p class="lead my-3">Multiple lines of text that form the lede, informing new readers quickly and efficiently about what’s most interesting in this post’s contents.</p>
      <p class="lead mb-0"><a href="#" class="text-body-emphasis fw-bold">Continue reading...</a></p>
    </div>
  </div>
  
  <div class="row mb-2">
    <div class="col-md-6">
      <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
        <div class="col p-4 d-flex flex-column position-static">
          <strong class="d-inline-block mb-2 text-primary-emphasis">World</strong>
          <h3 class="mb-0">Featured post</h3>
          <div class="mb-1 text-body-secondary">Nov 12</div>
          <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
          <a href="#" class="icon-link gap-1 icon-link-hover stretched-link">
            Continue reading
            <svg class="bi"><use xlink:href="#chevron-right"/></svg>
          </a>
        </div>
        <div class="col-auto d-none d-lg-block">
          <svg class="bd-placeholder-img" width="200" height="250" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Thumbnail" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#55595c"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Thumbnail</text></svg>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
        <div class="col p-4 d-flex flex-column position-static">
          <strong class="d-inline-block mb-2 text-success-emphasis">Design</strong>
          <h3 class="mb-0">Post title</h3>
          <div class="mb-1 text-body-secondary">Nov 11</div>
          <p class="mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
          <a href="#" class="icon-link gap-1 icon-link-hover stretched-link">
            Continue reading
            <svg class="bi"><use xlink:href="#chevron-right"/></svg>
          </a>
        </div>
        <div class="col-auto d-none d-lg-block">
          <svg class="bd-placeholder-img" width="200" height="250" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Thumbnail" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#55595c"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Thumbnail</text></svg>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row g-5">
    <div class="col-md-8">
      <h3 class="pb-4 mb-4 fst-italic border-bottom">
        From the Firehose
      </h3>
  
      <article class="blog-post">
        <div class="row">
          {% for product in products %}
          <div class="col-md-4 mt-3">
            <div class="card rounded-5 position-relative" style="background-color: #FFFFF0;">
              <div style="position: relative;">
                <img src="{{product.imageURL}}" class="rounded-top-5 card-img-top position-relative thumbnail" alt="...">
                <div class="stock-badge text-bg-danger">New</div>
                <span class="bi bi-heart-fill text-danger position-absolute bottom-0 end-0" style="font-size: 1.5rem;"></span>
              </div>
              <div class="card-body text-center">
                  <span class="bi bi-star-fill text-warning"></span>
                  <span class="bi bi-star-fill text-warning"></span>
                  <span class="bi bi-star-fill text-warning"></span>
                  <span class="bi bi-star-fill text-warning"></span>
                  <span class="bi bi-star-fill text-warning"></span>
                <h5 class="card-title">{{product.name}}</h5>
                <!--<p class="card-text">Descripción del producto.</p>-->
                <h6 class="card-text">${{ product.price|floatformat:2}}</h6>
                <div class="d-grid gap-2">
                  <button data-product="{{product.id}}" data-action="add" class="btn btn-outline-danger add-btn rounded-pill btn-block update-cart">Agregar al carrito <i class="bi bi-cart-plus"></i></button>
                  <a href="#" class="btn btn-outline-dark rounded-pill btn-block mt-2" data-bs-toggle="modal" data-bs-target="#exampleModalScrollable{{product.id}}">Ver más <i class="bi bi-eye"></i></a>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="badge text-bg-success">Envío gratis <i class="bi bi-truck"></i></span>
                    
                    <span class="badge text-bg-secondary"><i class="bi bi-plus-slash-minus"></i> {{product.quantity}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </article>
  
      <article class="blog-post">
        <h2 class="display-5 link-body-emphasis mb-1">New feature</h2>
        <p class="blog-post-meta">December 14, 2020 by <a href="#">Chris</a></p>
  
        <p>This is some additional paragraph placeholder content. It has been written to fill the available space and show how a longer snippet of text affects the surrounding content. We'll repeat it often to keep the demonstration flowing, so be on the lookout for this exact same string of text.</p>
        <ul>
          <li>First list item</li>
          <li>Second list item with a longer description</li>
          <li>Third list item to close it out</li>
        </ul>
        <p>This is some additional paragraph placeholder content. It's a slightly shorter version of the other highly repetitive body text used throughout.</p>
      </article>
  
      <nav class="blog-pagination" aria-label="Pagination">
        <a class="btn btn-outline-primary rounded-pill" href="#">Older</a>
        <a class="btn btn-outline-secondary rounded-pill disabled" aria-disabled="true">Newer</a>
      </nav>
  
    </div>
  
    <div class="col-md-4">
      <div class="position-sticky" style="top: 2rem;">
        <div class="p-4 mb-3 bg-body-tertiary rounded">
          <h4 class="fst-italic">About</h4>
          <p class="mb-0">Customize this section to tell your visitors a little bit about your publication, writers, content, or something else entirely. Totally up to you.</p>
        </div>
  
        <div>
          <h4 class="fst-italic">Recent posts</h4>
          <ul class="list-unstyled">
            <li>
              <a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="#">
                <svg class="bd-placeholder-img" width="100%" height="96" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#777"/></svg>
                <div class="col-lg-8">
                  <h6 class="mb-0">Example blog post title</h6>
                  <small class="text-body-secondary">January 15, 2024</small>
                </div>
              </a>
            </li>
            <li>
              <a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="#">
                <svg class="bd-placeholder-img" width="100%" height="96" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#777"/></svg>
                <div class="col-lg-8">
                  <h6 class="mb-0">This is another blog post title</h6>
                  <small class="text-body-secondary">January 14, 2024</small>
                </div>
              </a>
            </li>
            <li>
              <a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="#">
                <svg class="bd-placeholder-img" width="100%" height="96" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#777"/></svg>
                <div class="col-lg-8">
                  <h6 class="mb-0">Longer blog post title: This one has multiple lines!</h6>
                  <small class="text-body-secondary">January 13, 2024</small>
                </div>
              </a>
            </li>
          </ul>
        </div>
  
        <div class="p-4">
          <h4 class="fst-italic">Archives</h4>
          <ol class="list-unstyled mb-0">
            <li><a href="#">March 2021</a></li>
            <li><a href="#">February 2021</a></li>
            <li><a href="#">January 2021</a></li>
            <li><a href="#">December 2020</a></li>
            <li><a href="#">November 2020</a></li>
            <li><a href="#">October 2020</a></li>
            <li><a href="#">September 2020</a></li>
            <li><a href="#">August 2020</a></li>
            <li><a href="#">July 2020</a></li>
            <li><a href="#">June 2020</a></li>
            <li><a href="#">May 2020</a></li>
            <li><a href="#">April 2020</a></li>
          </ol>
        </div>
  
        <div class="p-4">
          <h4 class="fst-italic">Elsewhere</h4>
          <ol class="list-unstyled">
            <li><a href="#">GitHub</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Facebook</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  
</main>

<style>
  .stock-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    transform: translate(-50%, -50%) rotate(-45deg);
    color: white;
    padding: 5px 10px; /* Ajustar el padding según sea necesario */
    font-size: 0.8rem;
    display: inline-block;
    border-radius: 5px; /* Ajustar el radio del borde según sea necesario */
    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 80%, 0% 100%); /* Esto crea una forma de etiqueta */
}

</style>




{% for product in products %}
<!-- Modal -->
<div class="modal fade" id="exampleModalScrollable{{product.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle{{product.id}}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                 <h5>Visualiza más detalles del producto</h5>
                <button type="button" class="btn-close btn-close-white focus-ring" data-bs-dismiss="modal" aria-label="Close" style="--bs-focus-ring-color: rgba(var(--bs-danger-rgb), .25)"></button>
            </div>
            <div class="modal-body">         
             
              <section class="container my-5">
                <div class="row">
                  <div class="col-lg-6">
                    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                      <div class="carousel-inner">
                        <div class="carousel-item active">
                          <img src="{{product.imageURL}}" class="d-block w-100 thumbnail" alt="Imagen 1">
                        </div>
                        <div class="carousel-item">
                          <img src="{{product.imageunoURL}}" class="d-block w-100 thumbnail" alt="Imagen 2">
                        </div>
                        <div class="carousel-item">
                          <img src="{{product.imagedosURL}}" class="d-block w-100 thumbnail" alt="Imagen 3">
                        </div>
                      </div>
                      <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                      </button>
                      <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                      </button>
                    </div>
                    <hr>
                    <h3 class="mt-4">Detalles de Envío</h3>
                    <ul>
                      <li>Envío gratuito en pedidos superiores a $XX.XX</li>
                      <li>Entrega rápida dentro de 3-5 días hábiles</li>
                      <li>Seguimiento de envío disponible</li>
                    </ul>
                    <hr>
                    <h3 class="mt-4">Garantía</h3>
                    <p>Este producto está cubierto por nuestra garantía de satisfacción del 100%. Si tienes algún problema, contáctanos y te ayudaremos a resolverlo.</p>
                    <hr>
                    <h3 class="mt-4">Política de Devolución</h3>
                    <p>Aceptamos devoluciones dentro de los primeros 30 días posteriores a la compra. Para obtener más información, consulta nuestra política de devolución completa.</p>
                  </div>
                  <div class="col-lg-6">
                    <h2>{{ product.name }}</h2>
                    <span class="bi bi-star-fill text-warning"></span>
                    <span class="bi bi-star-fill text-warning"></span>
                    <span class="bi bi-star-fill text-warning"></span>
                    <span class="bi bi-star-fill text-warning"></span>
                    <span class="bi bi-star-fill text-warning"></span>
                    <p class="">{{ product.description }}</p>
                    <h3 class="mt-4">Detalles</h3>
                    <ul class="list-group">
                      <li class="list-group-item">Capacidad: {{ product.qualityuno }}</li>
                      <li class="list-group-item">Modelo: {{ product.qualitydos }}</li>
                      <li class="list-group-item">Generación: {{ product.qualitytres }}</li>
                      <li class="list-group-item">Gamer: {{ product.qualitycuatro }}</li>
                      <li class="list-group-item">Tecnología: {{ product.qualitycinco }}</li>
                    </ul>
                    <div class="mt-4">
                      <h3>${{ product.price|floatformat:2}}</h3>
                      <div class="row">
                        <div class="col-md-6 mb-2">
                          <button data-product="{{product.id}}" data-action="add" class="btn btn-danger add-btn update-cart rounded-pill w-100">Agregar al carrito <i class="bi bi-cart-plus"></i></button>
                        </div>
                        <div class="col-md-6 mb-2">
                          <button class="btn btn-outline-light rounded-pill w-100">Agregar a la Lista de Deseos</button>
                        </div>
                      </div>                      
                    </div>
                    <hr>
                    <h3 class="mt-4">Especificaciones Técnicas</h3>
                    <table class="table table-dark">
                      <tr>
                        <th>Inálambrico</th>
                        <td>{{ product.qualityseis }}</td>
                      </tr>
                      <tr>
                        <th>Recargable</th>
                        <td>{{ product.qualitysiete }}</td>
                      </tr>
                      <tr>
                        <th>Resolución de pantalla</th>
                        <td>{{ product.qualityocho }}</td>
                      </tr>
                      <tr>
                        <th>Voltaje</th>
                        <td>{{ product.qualitynueve }}</td>
                      </tr>
                    </table>
                    <hr>
                    <h3 class="mt-4">Reseñas de Clientes</h3>
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title">Nombre del Cliente</h5>
                        <p class="card-text">Excelente producto. Muy satisfecho con la compra.</p>
                        <p class="card-text"><small class="text-muted">Publicado el 1 de enero de 2024</small></p>
                      </div>
                    </div>
                    <div class="card mt-3">
                      <div class="card-body">
                        <h5 class="card-title">Nombre del Cliente</h5>
                        <p class="card-text">El producto llegó en perfectas condiciones. Recomiendo totalmente.</p>
                        <p class="card-text"><small class="text-muted">Publicado el 15 de febrero de 2024</small></p>
                      </div>
                    </div>
                    <!-- Agregar más reseñas si es necesario -->
                    <hr>
                    <h3 class="mt-4">Preguntas Frecuentes</h3>
                    <div class="accordion mt-3" id="faqAccordion">
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                          <button class="accordion-button focus-ring bg-danger-subtle" style="--bs-focus-ring-color: rgba(var(--bs-danger-rgb), .25)" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            ¿Cuál es la política de devolución?
                          </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                          <div class="accordion-body">
                            La política de devolución es de 30 días. Si no estás satisfecho con tu compra, puedes devolver el producto y recibir un reembolso completo.
                          </div>
                        </div>
                      </div>
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                          <button class="accordion-button collapsed focus-ring bg-danger-subtle" style="--bs-focus-ring-color: rgba(var(--bs-danger-rgb), .25)" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            ¿Cuánto tiempo tarda en llegar el producto?
                          </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                          <div class="accordion-body">
                            El tiempo de entrega es de 3 a 5 días hábiles después de confirmar tu compra.
                          </div>
                        </div>
                      </div>
                      <!-- Agregar más preguntas frecuentes si es necesario -->
                    </div>
                   
                  </div>
                </div>
                <!-- Agregar contenido adicional aquí, como productos relacionados, información adicional, etc. -->
              </section>
              

            </div>
            <div class="modal-footer">
                <!--Colocar contenido-->
            </div>
        </div>
    </div>
</div>
{% endfor %}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // Función para manejar el clic en los botones de agregar al carrito
        $('.update-cart').click(function(e) {
            // Verificar si el usuario está autenticado
            var isAuthenticated = '{{ request.user.is_authenticated }}';
            // Si el usuario no está autenticado, redirigirlo al formulario de inicio de sesión
            if (isAuthenticated === 'False') {
                e.preventDefault(); // Detener el comportamiento predeterminado del botón
                window.location.href = '{% url "login" %}'; // Redireccionar al formulario de inicio de sesión
            }
        });
    });
</script>

{% endblock content %}
